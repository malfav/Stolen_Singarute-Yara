import "pe"
import "console"

 rule Stolen_CA_Cert_Detecting{
	meta:
		Author = "Diyar Saadi"
		Note = "Malware Used Stolen CA Cert"
		Date = "06/08/2024"
		description = "The Certifcate is stolen an used in this malware"
	condition:
		console.log("Malware is signed ? : [1 means Available ] [0 means not Available] Number_Validator:", pe.number_of_signatures ) 
		and
		for all sign in pe.signatures:
		(
			sign.serial == 
			"42:6e:86:60:53:09:73:ac:4e:fd:3b:0d:41:f1:c6:1f" or
			sign.serial == 
			"2e:3c:dd:64:c2:66:e1:9e:47:99:56:52:fe:0c:79:a2"
			and
			sign.issuer 
			 == "/CN=Google Inc"
			 and
			 sign.number_of_certificates == 3
		)
}
rule CA_Cert_Validator{
	condition:
		for any  ca in pe.signatures:
		(
			console.log("Issuer : ", ca.issuer) and
			console.log("Subject : ", ca.subject) 
		)	    
}
rule Same_Issuer_CA{
	condition:
		for any issu in pe.signatures:
		(
			issu.issuer == issu.subject
		)
}
rule CA_SINGED_Issuer{
	condition:
		for any  ca in pe.signatures:
		(
			ca.issuer matches /[a-zA-Z0-9\.\_=\/\s]{1,5}/ 
			and
			console.log("Issuer : ", ca.issuer)
			and
			console.log("Subject : ", ca.subject) 
		)	   
}

